// apps/backend/prisma/schema.prisma

generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["multiSchema"] // Para multi-tenancy avan√ßado (opcional)
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// ENUMS
// ============================================================================

enum UserRole {
  SUPER_ADMIN
  CLUB_ADMIN
  COACH
  PARENT
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum PaymentType {
  MONTHLY_FEE
  REGISTRATION
  TOURNAMENT
  EQUIPMENT
  OTHER
}

enum PaymentMethod {
  MBWAY
  MULTIBANCO
  CREDIT_CARD
  CASH
  BANK_TRANSFER
}

enum OrderStatus {
  CART
  PENDING
  PAID
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
  REFUNDED
}

enum PlayerPosition {
  GOALKEEPER
  DEFENDER
  MIDFIELDER
  FORWARD
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  JUSTIFIED
  INJURED
}

enum MatchResult {
  WIN
  DRAW
  LOSS
  SCHEDULED
}

// ============================================================================
// MODELS - CORE TABLES
// ============================================================================

model Club {
  id                    String    @id @default(uuid()) @db.Uuid
  name                  String    @db.VarChar(255)
  subdomain             String    @unique @db.VarChar(100)
  logoUrl               String?   @map("logo_url") @db.Text
  email                 String    @unique @db.VarChar(255)
  phone                 String?   @db.VarChar(20)
  address               String?   @db.Text
  city                  String?   @db.VarChar(100)
  postalCode            String?   @map("postal_code") @db.VarChar(20)
  country               String    @default("Portugal") @db.VarChar(100)
  taxId                 String?   @map("tax_id") @db.VarChar(50)
  
  // Subscription
  subscriptionPlan      String    @default("FREE") @map("subscription_plan") @db.VarChar(50)
  subscriptionStatus    String    @default("ACTIVE") @map("subscription_status") @db.VarChar(50)
  subscriptionStartedAt DateTime  @default(now()) @map("subscription_started_at") @db.Timestamptz(6)
  subscriptionEndsAt    DateTime? @map("subscription_ends_at") @db.Timestamptz(6)
  
  // Settings (JSONB)
  settings              Json      @default("{\"currency\":\"EUR\",\"timezone\":\"Europe/Lisbon\",\"language\":\"pt\",\"notifications_enabled\":true,\"payment_reminders_days\":[7,3,1]}")
  
  // Audit
  createdAt             DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt             DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  users                 User[]
  teams                 Team[]
  players               Player[]
  trainings             Training[]
  matches               Match[]
  payments              Payment[]
  invoices              Invoice[]
  stockItems            StockItem[]
  orders                Order[]
  notifications         Notification[]
  playerTeamHistory     PlayerTeamHistory[]
  trainingAttendance    TrainingAttendance[]
  matchCallups          MatchCallup[]
  orderItems            OrderItem[]
  stockMovements        StockMovement[]

  @@map("clubs")
}

model User {
  id                      String    @id @default(uuid()) @db.Uuid
  clubId                  String    @map("club_id") @db.Uuid
  
  // Auth
  email                   String    @db.VarChar(255)
  passwordHash            String    @map("password_hash") @db.VarChar(255)
  role                    UserRole
  
  // Profile
  firstName               String    @map("first_name") @db.VarChar(100)
  lastName                String    @map("last_name") @db.VarChar(100)
  phone                   String?   @db.VarChar(20)
  avatarUrl               String?   @map("avatar_url") @db.Text
  birthDate               DateTime? @map("birth_date") @db.Date
  
  // Security
  emailVerified           Boolean   @default(false) @map("email_verified")
  emailVerifiedAt         DateTime? @map("email_verified_at") @db.Timestamptz(6)
  lastLoginAt             DateTime? @map("last_login_at") @db.Timestamptz(6)
  isActive                Boolean   @default(true) @map("is_active")
  resetPasswordToken      String?   @map("reset_password_token") @db.VarChar(255)
  resetPasswordExpiresAt  DateTime? @map("reset_password_expires_at") @db.Timestamptz(6)
  
  // Audit
  createdAt               DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt               DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  club                    Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  
  // As parent
  children                Player[]  @relation("ParentToPlayers")
  
  // As coach
  teamsAsHead             Team[]    @relation("HeadCoach")
  teamsAsAssistant        Team[]    @relation("AssistantCoach")
  trainings               Training[]
  
  // As payer
  payments                Payment[] @relation("PayerPayments")
  processedPayments       Payment[] @relation("ProcessedPayments")
  
  // As customer
  orders                  Order[]
  
  notifications           Notification[]
  matchCallups            MatchCallup[]
  trainingAttendanceMarked TrainingAttendance[]
  stockMovements          StockMovement[]

  @@unique([clubId, email])
  @@map("users")
}

// ============================================================================
// MODELS - SPORTS MANAGEMENT
// ============================================================================

model Team {
  id                String    @id @default(uuid()) @db.Uuid
  clubId            String    @map("club_id") @db.Uuid
  
  name              String    @db.VarChar(255)
  category          String?   @db.VarChar(100)
  gender            String?   @db.VarChar(10)
  season            String    @db.VarChar(20)
  
  // Coaches
  headCoachId       String?   @map("head_coach_id") @db.Uuid
  assistantCoachId  String?   @map("assistant_coach_id") @db.Uuid
  
  description       String?   @db.Text
  teamPhotoUrl      String?   @map("team_photo_url") @db.Text
  
  // Audit
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt         DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  club              Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  headCoach         User?     @relation("HeadCoach", fields: [headCoachId], references: [id], onDelete: SetNull)
  assistantCoach    User?     @relation("AssistantCoach", fields: [assistantCoachId], references: [id], onDelete: SetNull)
  
  players           Player[]
  trainings         Training[]
  matches           Match[]
  playerTeamHistory PlayerTeamHistory[]

  @@unique([clubId, name, season])
  @@map("teams")
}

model Player {
  id                        String    @id @default(uuid()) @db.Uuid
  clubId                    String    @map("club_id") @db.Uuid
  
  // Personal
  firstName                 String    @map("first_name") @db.VarChar(100)
  lastName                  String    @map("last_name") @db.VarChar(100)
  birthDate                 DateTime  @map("birth_date") @db.Date
  gender                    String?   @db.VarChar(10)
  photoUrl                  String?   @map("photo_url") @db.Text
  
  // Parent
  parentId                  String    @map("parent_id") @db.Uuid
  
  // Team
  currentTeamId             String?   @map("current_team_id") @db.Uuid
  
  // Player details
  jerseyNumber              Int?      @map("jersey_number")
  preferredPosition         PlayerPosition? @map("preferred_position")
  heightCm                  Int?      @map("height_cm")
  weightKg                  Decimal?  @map("weight_kg") @db.Decimal(5, 2)
  
  // Emergency
  emergencyContactName      String?   @map("emergency_contact_name") @db.VarChar(255)
  emergencyContactPhone     String?   @map("emergency_contact_phone") @db.VarChar(20)
  
  // Health
  bloodType                 String?   @map("blood_type") @db.VarChar(5)
  allergies                 String?   @db.Text
  medicalConditions         String?   @map("medical_conditions") @db.Text
  medicalCertificateUrl     String?   @map("medical_certificate_url") @db.Text
  medicalCertificateExpiresAt DateTime? @map("medical_certificate_expires_at") @db.Date
  
  // Docs
  citizenCardNumber         String?   @map("citizen_card_number") @db.VarChar(50)
  taxId                     String?   @map("tax_id") @db.VarChar(50)
  
  // Status
  isActive                  Boolean   @default(true) @map("is_active")
  registrationDate          DateTime  @default(now()) @map("registration_date") @db.Date
  
  // Audit
  createdAt                 DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                 DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt                 DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  club                      Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  parent                    User      @relation("ParentToPlayers", fields: [parentId], references: [id], onDelete: Restrict)
  currentTeam               Team?     @relation(fields: [currentTeamId], references: [id], onDelete: SetNull)
  
  payments                  Payment[]
  teamHistory               PlayerTeamHistory[]
  trainingAttendance        TrainingAttendance[]
  matchCallups              MatchCallup[]

  @@map("players")
}

model PlayerTeamHistory {
  id          String    @id @default(uuid()) @db.Uuid
  clubId      String    @map("club_id") @db.Uuid
  playerId    String    @map("player_id") @db.Uuid
  teamId      String    @map("team_id") @db.Uuid
  
  joinedAt    DateTime  @default(now()) @map("joined_at") @db.Date
  leftAt      DateTime? @map("left_at") @db.Date
  
  matchesPlayed Int     @default(0) @map("matches_played")
  goalsScored   Int     @default(0) @map("goals_scored")
  
  createdAt   DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  
  // Relations
  club        Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  player      Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  team        Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)

  @@map("player_team_history")
}

model Training {
  id                String    @id @default(uuid()) @db.Uuid
  clubId            String    @map("club_id") @db.Uuid
  teamId            String    @map("team_id") @db.Uuid
  coachId           String    @map("coach_id") @db.Uuid
  
  scheduledDate     DateTime  @map("scheduled_date") @db.Date
  startTime         DateTime  @map("start_time") @db.Time(6)
  endTime           DateTime  @map("end_time") @db.Time(6)
  
  location          String    @db.VarChar(255)
  fieldType         String?   @map("field_type") @db.VarChar(50)
  
  title             String?   @db.VarChar(255)
  objectives        String?   @db.Text
  exercises         Json      @default("[]")
  notes             String?   @db.Text
  
  isCancelled       Boolean   @default(false) @map("is_cancelled")
  cancellationReason String?  @map("cancellation_reason") @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club              Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team              Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  coach             User      @relation(fields: [coachId], references: [id], onDelete: Restrict)
  
  attendance        TrainingAttendance[]

  @@map("trainings")
}

model TrainingAttendance {
  id              String    @id @default(uuid()) @db.Uuid
  clubId          String    @map("club_id") @db.Uuid
  trainingId      String    @map("training_id") @db.Uuid
  playerId        String    @map("player_id") @db.Uuid
  
  status          AttendanceStatus @default(PRESENT)
  arrivedAt       DateTime? @map("arrived_at") @db.Time(6)
  justification   String?   @db.Text
  notes           String?   @db.Text
  
  markedByUserId  String?   @map("marked_by_user_id") @db.Uuid
  markedAt        DateTime? @map("marked_at") @db.Timestamptz(6)
  
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  training        Training  @relation(fields: [trainingId], references: [id], onDelete: Cascade)
  player          Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  markedByUser    User?     @relation(fields: [markedByUserId], references: [id])

  @@unique([trainingId, playerId])
  @@map("training_attendance")
}

model Match {
  id            String    @id @default(uuid()) @db.Uuid
  clubId        String    @map("club_id") @db.Uuid
  teamId        String    @map("team_id") @db.Uuid
  
  opponentName  String    @map("opponent_name") @db.VarChar(255)
  competition   String?   @db.VarChar(255)
  
  matchDate     DateTime  @map("match_date") @db.Date
  matchTime     DateTime? @map("match_time") @db.Time(6)
  location      String    @db.VarChar(255)
  isHomeMatch   Boolean   @default(true) @map("is_home_match")
  
  result        MatchResult @default(SCHEDULED)
  goalsFor      Int?      @map("goals_for")
  goalsAgainst  Int?      @map("goals_against")
  
  statistics    Json      @default("{}")
  notes         String?   @db.Text
  
  createdAt     DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club          Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  team          Team      @relation(fields: [teamId], references: [id], onDelete: Cascade)
  
  callups       MatchCallup[]

  @@map("matches")
}

model MatchCallup {
  id                  String    @id @default(uuid()) @db.Uuid
  clubId              String    @map("club_id") @db.Uuid
  matchId             String    @map("match_id") @db.Uuid
  playerId            String    @map("player_id") @db.Uuid
  
  isStarter           Boolean   @default(false) @map("is_starter")
  position            PlayerPosition?
  jerseyNumber        Int?      @map("jersey_number")
  
  played              Boolean   @default(false)
  minutesPlayed       Int       @default(0) @map("minutes_played")
  goalsScored         Int       @default(0) @map("goals_scored")
  assists             Int       @default(0)
  yellowCards         Int       @default(0) @map("yellow_cards")
  redCard             Boolean   @default(false) @map("red_card")
  
  performanceRating   Decimal?  @map("performance_rating") @db.Decimal(3, 1)
  notes               String?   @db.Text
  
  createdByUserId     String?   @map("created_by_user_id") @db.Uuid
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club                Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  match               Match     @relation(fields: [matchId], references: [id], onDelete: Cascade)
  player              Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  createdByUser       User?     @relation(fields: [createdByUserId], references: [id])

  @@unique([matchId, playerId])
  @@map("match_callups")
}

// ============================================================================
// MODELS - FINANCIAL
// ============================================================================

model Payment {
  id                  String    @id @default(uuid()) @db.Uuid
  clubId              String    @map("club_id") @db.Uuid
  playerId            String    @map("player_id") @db.Uuid
  payerId             String    @map("payer_id") @db.Uuid
  
  paymentType         PaymentType @map("payment_type")
  amount              Decimal   @db.Decimal(10, 2)
  currency            String    @default("EUR") @db.VarChar(3)
  
  status              PaymentStatus @default(PENDING)
  paymentMethod       PaymentMethod? @map("payment_method")
  referenceCode       String?   @map("reference_code") @db.VarChar(100)
  transactionId       String?   @map("transaction_id") @db.VarChar(255)
  
  dueDate             DateTime  @map("due_date") @db.Date
  paidAt              DateTime? @map("paid_at") @db.Timestamptz(6)
  
  periodStart         DateTime? @map("period_start") @db.Date
  periodEnd           DateTime? @map("period_end") @db.Date
  
  description         String?   @db.Text
  notes               String?   @db.Text
  
  reminderSentCount   Int       @default(0) @map("reminder_sent_count")
  lastReminderSentAt  DateTime? @map("last_reminder_sent_at") @db.Timestamptz(6)
  
  processedByUserId   String?   @map("processed_by_user_id") @db.Uuid
  
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt           DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  club                Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  player              Player    @relation(fields: [playerId], references: [id], onDelete: Cascade)
  payer               User      @relation("PayerPayments", fields: [payerId], references: [id], onDelete: Restrict)
  processedByUser     User?     @relation("ProcessedPayments", fields: [processedByUserId], references: [id])
  
  invoices            Invoice[]
  orders              Order[]

  @@map("payments")
}

model Invoice {
  id                String    @id @default(uuid()) @db.Uuid
  clubId            String    @map("club_id") @db.Uuid
  paymentId         String?   @map("payment_id") @db.Uuid
  
  invoiceNumber     String    @map("invoice_number") @db.VarChar(50)
  invoiceSeries     String    @default("A") @map("invoice_series") @db.VarChar(10)
  
  subtotal          Decimal   @db.Decimal(10, 2)
  taxRate           Decimal   @default(0) @map("tax_rate") @db.Decimal(5, 2)
  taxAmount         Decimal   @default(0) @map("tax_amount") @db.Decimal(10, 2)
  totalAmount       Decimal   @map("total_amount") @db.Decimal(10, 2)
  
  billedToName      String    @map("billed_to_name") @db.VarChar(255)
  billedToTaxId     String?   @map("billed_to_tax_id") @db.VarChar(50)
  billedToAddress   String?   @map("billed_to_address") @db.Text
  
  items             Json      @default("[]")
  
  issueDate         DateTime  @default(now()) @map("issue_date") @db.Date
  dueDate           DateTime? @map("due_date") @db.Date
  
  pdfUrl            String?   @map("pdf_url") @db.Text
  pdfGeneratedAt    DateTime? @map("pdf_generated_at") @db.Timestamptz(6)
  
  isCancelled       Boolean   @default(false) @map("is_cancelled")
  cancelledAt       DateTime? @map("cancelled_at") @db.Timestamptz(6)
  cancellationReason String?  @map("cancellation_reason") @db.Text
  
  notes             String?   @db.Text
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club              Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  payment           Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)

  @@unique([clubId, invoiceSeries, invoiceNumber])
  @@map("invoices")
}

model StockItem {
  id                  String    @id @default(uuid()) @db.Uuid
  clubId              String    @map("club_id") @db.Uuid
  
  name                String    @db.VarChar(255)
  description         String?   @db.Text
  sku                 String?   @db.VarChar(100)
  category            String?   @db.VarChar(100)
  
  price               Decimal   @db.Decimal(10, 2)
  costPrice           Decimal?  @map("cost_price") @db.Decimal(10, 2)
  currency            String    @default("EUR") @db.VarChar(3)
  
  stockQuantity       Int       @default(0) @map("stock_quantity")
  lowStockThreshold   Int       @default(5) @map("low_stock_threshold")
  
  sizesAvailable      String[]  @map("sizes_available")
  colorsAvailable     String[]  @map("colors_available")
  
  imageUrl            String?   @map("image_url") @db.Text
  additionalImages    String[]  @map("additional_images")
  
  isActive            Boolean   @default(true) @map("is_active")
  isFeatured          Boolean   @default(false) @map("is_featured")
  displayOrder        Int       @default(0) @map("display_order")
  
  createdAt           DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  deletedAt           DateTime? @map("deleted_at") @db.Timestamptz(6)
  
  // Relations
  club                Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  
  orderItems          OrderItem[]
  stockMovements      StockMovement[]

  @@map("stock_items")
}

model Order {
  id                    String    @id @default(uuid()) @db.Uuid
  clubId                String    @map("club_id") @db.Uuid
  customerId            String    @map("customer_id") @db.Uuid
  
  orderNumber           String    @map("order_number") @db.VarChar(50)
  status                OrderStatus @default(CART)
  
  subtotal              Decimal   @db.Decimal(10, 2)
  shippingCost          Decimal   @default(0) @map("shipping_cost") @db.Decimal(10, 2)
  taxAmount             Decimal   @default(0) @map("tax_amount") @db.Decimal(10, 2)
  discountAmount        Decimal   @default(0) @map("discount_amount") @db.Decimal(10, 2)
  totalAmount           Decimal   @map("total_amount") @db.Decimal(10, 2)
  currency              String    @default("EUR") @db.VarChar(3)
  
  shippingAddress       String?   @map("shipping_address") @db.Text
  shippingCity          String?   @map("shipping_city") @db.VarChar(100)
  shippingPostalCode    String?   @map("shipping_postal_code") @db.VarChar(20)
  shippingCountry       String    @default("Portugal") @map("shipping_country") @db.VarChar(100)
  
  estimatedDeliveryDate DateTime? @map("estimated_delivery_date") @db.Date
  deliveredAt           DateTime? @map("delivered_at") @db.Timestamptz(6)
  trackingNumber        String?   @map("tracking_number") @db.VarChar(255)
  
  paymentId             String?   @map("payment_id") @db.Uuid
  paymentMethod         PaymentMethod? @map("payment_method")
  
  customerNotes         String?   @map("customer_notes") @db.Text
  internalNotes         String?   @map("internal_notes") @db.Text
  
  placedAt              DateTime? @map("placed_at") @db.Timestamptz(6)
  paidAt                DateTime? @map("paid_at") @db.Timestamptz(6)
  shippedAt             DateTime? @map("shipped_at") @db.Timestamptz(6)
  cancelledAt           DateTime? @map("cancelled_at") @db.Timestamptz(6)
  
  createdAt             DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime  @updatedAt @map("updated_at") @db.Timestamptz(6)
  
  // Relations
  club                  Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  customer              User      @relation(fields: [customerId], references: [id], onDelete: Restrict)
  payment               Payment?  @relation(fields: [paymentId], references: [id], onDelete: SetNull)
  
  items                 OrderItem[]

  @@unique([clubId, orderNumber])
  @@map("orders")
}

model OrderItem {
  id              String    @id @default(uuid()) @db.Uuid
  clubId          String    @map("club_id") @db.Uuid
  orderId         String    @map("order_id") @db.Uuid
  stockItemId     String    @map("stock_item_id") @db.Uuid
  
  productName     String    @map("product_name") @db.VarChar(255)
  productSku      String?   @map("product_sku") @db.VarChar(100)
  
  selectedSize    String?   @map("selected_size") @db.VarChar(50)
  selectedColor   String?   @map("selected_color") @db.VarChar(50)
  
  unitPrice       Decimal   @map("unit_price") @db.Decimal(10, 2)
  quantity        Int
  subtotal        Decimal   @db.Decimal(10, 2)
  discountAmount  Decimal   @default(0) @map("discount_amount") @db.Decimal(10, 2)
  totalAmount     Decimal   @map("total_amount") @db.Decimal(10, 2)
  
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  
  // Relations
  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  order           Order     @relation(fields: [orderId], references: [id], onDelete: Cascade)
  stockItem       StockItem @relation(fields: [stockItemId], references: [id], onDelete: Restrict)
  
  stockMovements  StockMovement[]

  @@map("order_items")
}

model StockMovement {
  id              String    @id @default(uuid()) @db.Uuid
  clubId          String    @map("club_id") @db.Uuid
  stockItemId     String    @map("stock_item_id") @db.Uuid
  
  movementType    String    @db.VarChar(50)
  quantity        Int
  
  orderItemId     String?   @map("order_item_id") @db.Uuid
  
  quantityBefore  Int       @map("quantity_before")
  quantityAfter   Int       @map("quantity_after")
  
  reason          String?   @db.Text
  
  createdByUserId String?   @map("created_by_user_id") @db.Uuid
  createdAt       DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  
  // Relations
  club            Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  stockItem       StockItem @relation(fields: [stockItemId], references: [id], onDelete: Cascade)
  orderItem       OrderItem? @relation(fields: [orderItemId], references: [id])
  createdByUser   User?     @relation(fields: [createdByUserId], references: [id])

  @@map("stock_movements")
}

// ============================================================================
// MODELS - NOTIFICATIONS
// ============================================================================

model Notification {
  id                String    @id @default(uuid()) @db.Uuid
  clubId            String    @map("club_id") @db.Uuid
  userId            String    @map("user_id") @db.Uuid
  
  type              String    @db.VarChar(100)
  title             String    @db.VarChar(255)
  message           String    @db.Text
  
  relatedEntityType String?   @map("related_entity_type") @db.VarChar(100)
  relatedEntityId   String?   @map("related_entity_id") @db.Uuid
  
  actionUrl         String?   @map("action_url") @db.Text
  
  isRead            Boolean   @default(false) @map("is_read")
  readAt            DateTime? @map("read_at") @db.Timestamptz(6)
  
  sentVia           String[]  @map("sent_via")
  
  createdAt         DateTime  @default(now()) @map("created_at") @db.Timestamptz(6)
  
  // Relations
  club              Club      @relation(fields: [clubId], references: [id], onDelete: Cascade)
  user              User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("notifications")
}